<!DOCTYPE html>
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti√≥n de Grupos</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
    <style>
        /* Estilos b√°sicos */
        body { font-family: Arial, sans-serif; text-align: center; }
        table { width: 80%; margin: 20px auto; border-collapse: collapse; }
        th, td { border: 1px solid black; padding: 8px; text-align: center; }
        #abrirModalGrupo { margin: 20px; padding: 10px; background: blue; color: white; cursor: pointer; }
        .modal { display: none; position: fixed; z-index: 1; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); }
        .modal-content { background-color: white; padding: 20px; margin: 15% auto; width: 30%; }
        .close { color: red; float: right; font-size: 28px; cursor: pointer; }
    </style>
</head>
<body>
    {% load static %}
    <header>
        <img src="{% static 'img/logo.png' %}" alt="Logo" class="header-img">

    <div class="grid-container">
        <a href="{% url 'turnos' %}" class="box">Turnos</a>
        <a href="{% url 'empleados' %}" class="box">Empleados</a>
        <a href="{% url 'grupos' %}" class="box">Grupos</a>
        <a href="{% url 'reportes' %}" class="box">Reportes</a>
        <a href="{% url 'configuracion' %}" class="box">Configuraciones</a>
    </div>
    </header>

    <h1>Gesti√≥n de Grupos</h1>

    <!-- Bot√≥n para abrir el modal -->
    <button id="crearGrupoBtn" class="btn btn-primary">Crear Grupo</button>


    <!-- Modal para crear grupo -->
    <div id="modalGrupo" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Crear Grupo</h2>

            <form id="formCrearGrupo" method="post">
                {% csrf_token %}
                <label>Nombre del Grupo:</label>
                <input type="text" name="nombre" required>  <!-- Aseg√∫rate de que sea "nombre" -->
                <button type="submit">Guardar</button>
            </form>
            

        </div>
    </div>
    

    <!-- Tabla para visualizar los grupos -->
    <table id="gruposTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nombre del Grupo</th>
            </tr>
        </thead>
        <tbody id="gruposBody"> <!-- ID correcto para actualizaci√≥n din√°mica -->
            {% for grupo in grupos %}  
            <tr>
                <td>{{ grupo.id }}</td>  <!-- ‚úÖ Mostrar ID del grupo -->
                <td>{{ grupo.nombre }}</td>  <!-- ‚úÖ Mostrar Nombre del grupo -->
            </tr>
            {% empty %}
            <tr>
                <td colspan="2">No hay grupos registrados.</td>  <!-- ‚úÖ Mensaje si no hay datos -->
            </tr>
            {% endfor %}
        </tbody>
    </table>
    


    <script>
       
        $(document).ready(function () {
    console.log("‚úÖ Script cargado correctamente");

    // ‚úÖ Cargar lista de grupos al inicio
    function cargarGrupos() {
        $.get("/grupos/obtener/", function (response) {  // ‚úÖ Llamar a la nueva API
            console.log("‚úÖ Datos recibidos:", response);
            let tbody = $("#gruposBody");
            tbody.empty();  // üî• Limpiar la tabla antes de actualizar

            if (response.grupos.length > 0) {
                response.grupos.forEach(function (grupo) {
                    tbody.append(`
                        <tr>
                            <td>${grupo.id}</td>
                            <td>${grupo.nombre}</td>
                        </tr>
                    `);
                });
            } else {
                tbody.append(`<tr><td colspan="2">No hay grupos registrados.</td></tr>`);
            }
        }).fail(function (xhr) {
            console.error("‚ùå Error al cargar grupos:", xhr.responseText);
        });
    }


    // ‚úÖ Cargar grupos al inicio
    cargarGrupos();

    // ‚úÖ Abrir y cerrar modal
    $("#crearGrupoBtn").click(function () {
        console.log("‚úÖ Bot√≥n Crear Grupo clickeado");
        $("#modalGrupo").fadeIn();
    });

    $(".close").click(function () {
        console.log("‚úÖ Modal cerrado");
        $("#modalGrupo").fadeOut();
    });

    // ‚úÖ Enviar formulario de creaci√≥n de grupo
    $("#formCrearGrupo").submit(function (event) {
        event.preventDefault();

        let data = {
            nombre: $("input[name=nombre]").val(),
            csrfmiddlewaretoken: $("input[name=csrfmiddlewaretoken]").val()
        };

        $.post("/grupos/crear/", data, function (response) {
            console.log("‚úÖ Grupo creado:", response);

            if (response.success) {
                alert("‚úÖ Grupo creado con √©xito");
                $("#modalGrupo").fadeOut();
                $("input[name=nombre]").val("");  // ‚úÖ Limpiar campo
                cargarGrupos();  // üî• Recargar los datos despu√©s de crear
            } else {
                alert("‚ùå Error: " + response.error);
            }
        }).fail(function (xhr) {
            console.error("‚ùå Error en la petici√≥n:", xhr.responseText);
            alert("‚ùå Error al crear el grupo");
        });
    });
});
        
        

    </script>
        
        
        <a href="{% url 'home' %}">Volver al Inicio</a>
</body>
</html>
